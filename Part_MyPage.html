<link
  href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&family=Noto+Sans+JP:wght@400;700;900&display=swap"
  rel="stylesheet">

<div id="app-container" class="mp-wrapper mp-theme-default">

  <div class="mp-content">

    <!-- ===== LUXURY STATUS CARD ===== -->
    <div class="mp-card">
      <div class="mp-card-bg-art"></div>
      <div class="mp-card-shine"></div>
      <div class="mp-card-inner">

        <!-- Top: rank badge + refresh -->
        <div class="mp-card-top">
          <div class="mp-rank-pill">
            <i id="rank-icon" class="bi bi-stars"></i>
            <span id="my-rank-text" class="mp-rank-text">LOADING</span>
          </div>
          <button class="mp-refresh" onclick="loadMyPageData(window.GLOBAL_PASSCODE)">
            <i class="bi bi-arrow-clockwise"></i>
          </button>
        </div>

        <!-- Name -->
        <div class="mp-name-area">
          <h1 class="mp-name" id="my-name">...</h1>
        </div>

        <!-- Divider line -->
        <div class="mp-divider"></div>

        <!-- Bottom stats -->
        <div class="mp-bottom-stats">
          <div class="mp-earning">
            <div class="mp-earning-label">ESTIMATED</div>
            <div class="mp-earning-value mp-glow-text">
              <span class="mp-yen">¥</span><span id="my-money">0</span>
            </div>
          </div>
          <div class="mp-score-area">
            <div class="mp-score-display">
              <span class="mp-score-num" id="my-score">0</span>
              <span class="mp-score-pt">pt</span>
            </div>
            <div class="mp-rank-bar-wrap">
              <div class="mp-rank-bar-track">
                <div id="rank-progress" class="mp-rank-bar-fill" style="width: 0%;"></div>
              </div>
              <div class="mp-rank-next">NEXT +<span id="score-diff">0</span></div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- ===== RANK EMBLEM (decorative) ===== -->
    <div class="mp-emblem-area">
      <div class="mp-emblem" id="mp-emblem">
        <i id="mp-emblem-icon" class="bi bi-stars"></i>
      </div>
      <div class="mp-emblem-label" id="mp-emblem-rank">REGULAR</div>
      <div class="mp-emblem-sub">MEMBER SINCE 2025</div>
    </div>

  </div>
</div>

<style>
  /* ========================================
     MY PAGE - LUXURY MOBILE CARD
     ======================================== */

  .mp-wrapper {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    background: var(--mp-bg);
    transition: background 0.6s ease;
  }

  .mp-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 24px 16px 100px;
    max-width: 420px;
    margin: 0 auto;
    width: 100%;
  }

  /* ===== THEME VARIABLES ===== */
  .mp-theme-default {
    --mp-bg: #f3f4f6;
    --mp-card-bg: linear-gradient(145deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    --mp-text: #fff;
    --mp-text-dim: rgba(255,255,255,0.5);
    --mp-glass: rgba(255,255,255,0.12);
    --mp-glass-border: rgba(255,255,255,0.15);
    --mp-bar-fill: #fff;
    --mp-shadow: 0 20px 60px rgba(0,0,0,0.25);
    --mp-emblem-bg: rgba(0,0,0,0.04);
    --mp-emblem-text: #6b7280;
    --mp-accent: #3b82f6;
  }

  .mp-rank-regular {
    --mp-bg: #eef1f5;
    --mp-card-bg: linear-gradient(145deg, #1e3c72 0%, #2a5298 50%, #1e3c72 100%);
    --mp-text: #fff;
    --mp-text-dim: rgba(255,255,255,0.45);
    --mp-glass: rgba(255,255,255,0.12);
    --mp-glass-border: rgba(255,255,255,0.18);
    --mp-bar-fill: rgba(255,255,255,0.9);
    --mp-shadow: 0 20px 60px rgba(30,60,114,0.35);
    --mp-emblem-bg: rgba(30,60,114,0.06);
    --mp-emblem-text: #4a6fa5;
    --mp-accent: #2a5298;
  }

  .mp-rank-bronze {
    --mp-bg: #faf5f2;
    --mp-card-bg: linear-gradient(145deg, #cd7f32 0%, #a0522d 40%, #8b4513 100%);
    --mp-text: #fff;
    --mp-text-dim: rgba(255,255,255,0.5);
    --mp-glass: rgba(255,255,255,0.18);
    --mp-glass-border: rgba(255,255,255,0.22);
    --mp-bar-fill: rgba(255,255,255,0.9);
    --mp-shadow: 0 20px 60px rgba(160,82,45,0.35);
    --mp-emblem-bg: rgba(205,127,50,0.08);
    --mp-emblem-text: #a0522d;
    --mp-accent: #cd7f32;
  }

  .mp-rank-silver {
    --mp-bg: #f0f2f5;
    --mp-card-bg: linear-gradient(145deg, #e8ecf1 0%, #c0c8d4 40%, #8a9bb0 100%);
    --mp-text: #1e293b;
    --mp-text-dim: rgba(30,41,59,0.45);
    --mp-glass: rgba(30,41,59,0.08);
    --mp-glass-border: rgba(30,41,59,0.12);
    --mp-bar-fill: #334155;
    --mp-shadow: 0 20px 60px rgba(51,65,85,0.2);
    --mp-emblem-bg: rgba(51,65,85,0.05);
    --mp-emblem-text: #64748b;
    --mp-accent: #475569;
  }

  .mp-rank-gold {
    --mp-bg: #fdfaf0;
    --mp-card-bg: linear-gradient(145deg, #f7e8b0 0%, #d4a843 35%, #b8860b 70%, #8b6914 100%);
    --mp-text: #3a2e00;
    --mp-text-dim: rgba(58,46,0,0.45);
    --mp-glass: rgba(58,46,0,0.08);
    --mp-glass-border: rgba(58,46,0,0.12);
    --mp-bar-fill: #5a4500;
    --mp-shadow: 0 20px 60px rgba(184,134,11,0.3);
    --mp-emblem-bg: rgba(184,134,11,0.07);
    --mp-emblem-text: #b8860b;
    --mp-accent: #b8860b;
  }

  .mp-rank-platinum {
    --mp-bg: #080808;
    --mp-card-bg: linear-gradient(145deg, #1a1a1a 0%, #0d0d0d 40%, #000 70%);
    --mp-text: #d4af37;
    --mp-text-dim: rgba(212,175,55,0.4);
    --mp-glass: rgba(212,175,55,0.1);
    --mp-glass-border: rgba(212,175,55,0.25);
    --mp-bar-fill: linear-gradient(90deg, #d4af37, #f1c40f);
    --mp-shadow: 0 20px 80px rgba(0,0,0,0.6), 0 0 40px rgba(212,175,55,0.12);
    --mp-emblem-bg: rgba(212,175,55,0.06);
    --mp-emblem-text: #d4af37;
    --mp-accent: #d4af37;
  }

  .mp-rank-platinum .mp-name,
  .mp-rank-platinum .mp-glow-text {
    background: linear-gradient(to bottom, #fff 20%, #f3e5ab 60%, #d4af37 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 0 12px rgba(212,175,55,0.4));
  }

  .mp-rank-platinum .mp-rank-bar-fill {
    background: linear-gradient(90deg, #d4af37, #f1c40f) !important;
  }

  .mp-rank-platinum .mp-card {
    border: 1px solid rgba(212,175,55,0.3) !important;
  }

  .mp-rank-platinum .mp-emblem {
    border-color: rgba(212,175,55,0.3);
    box-shadow: 0 0 30px rgba(212,175,55,0.15);
  }

  .mp-rank-platinum .mp-emblem i {
    background: linear-gradient(to bottom, #fff, #d4af37);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  /* ===== CARD ===== */
  .mp-card {
    width: 100%;
    background: var(--mp-card-bg);
    border-radius: 24px;
    box-shadow: var(--mp-shadow);
    position: relative;
    overflow: hidden;
    color: var(--mp-text);
    padding: 28px 24px 24px;
  }

  .mp-card-bg-art {
    position: absolute;
    inset: 0;
    pointer-events: none;
    opacity: 0.12;
    background-image:
      radial-gradient(circle at 85% 15%, rgba(255,255,255,0.4) 0%, transparent 40%),
      radial-gradient(circle at 10% 85%, rgba(255,255,255,0.15) 0%, transparent 50%);
  }

  .mp-card-shine {
    position: absolute;
    top: -100%;
    left: -100%;
    width: 300%;
    height: 300%;
    background: linear-gradient(115deg, transparent 40%, rgba(255,255,255,0.2) 45%, transparent 50%);
    animation: mpShine 8s infinite cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
  }

  @keyframes mpShine {
    0%   { transform: translate(-10%, -10%); }
    100% { transform: translate(50%, 50%); }
  }

  .mp-card-inner {
    position: relative;
    z-index: 1;
  }

  /* Top row */
  .mp-card-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .mp-rank-pill {
    display: flex;
    align-items: center;
    gap: 7px;
    background: var(--mp-glass);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--mp-glass-border);
    border-radius: 24px;
    padding: 6px 16px;
  }

  .mp-rank-pill i {
    font-size: 0.9rem;
  }

  .mp-rank-text {
    font-family: 'Inter', sans-serif;
    font-size: 0.68rem;
    font-weight: 800;
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  .mp-refresh {
    background: var(--mp-glass);
    border: 1px solid var(--mp-glass-border);
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: inherit;
    opacity: 0.5;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 1rem;
  }

  .mp-refresh:active {
    transform: scale(0.88) rotate(-90deg);
    opacity: 1;
  }

  /* Name */
  .mp-name-area {
    margin-bottom: 20px;
  }

  .mp-name {
    font-family: 'Inter', 'Noto Sans JP', sans-serif;
    font-size: 2rem;
    font-weight: 900;
    margin: 0;
    line-height: 1.15;
    text-shadow: 0 4px 16px rgba(0,0,0,0.3);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    letter-spacing: -0.5px;
  }

  /* Divider */
  .mp-divider {
    height: 1px;
    background: var(--mp-glass-border);
    margin-bottom: 20px;
  }

  /* Bottom stats */
  .mp-bottom-stats {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
  }

  .mp-earning {
    flex: 1;
  }

  .mp-earning-label {
    font-family: 'Inter', sans-serif;
    font-size: 0.58rem;
    font-weight: 700;
    letter-spacing: 2px;
    color: var(--mp-text-dim);
    margin-bottom: 4px;
  }

  .mp-earning-value {
    font-family: 'Inter', sans-serif;
    font-size: 2rem;
    font-weight: 900;
    line-height: 1;
    letter-spacing: -1.5px;
    font-feature-settings: "tnum";
  }

  .mp-yen {
    font-size: 1.2rem;
    opacity: 0.6;
    margin-right: 2px;
    font-weight: 700;
  }

  .mp-score-area {
    text-align: right;
    min-width: 100px;
  }

  .mp-score-display {
    display: flex;
    align-items: baseline;
    justify-content: flex-end;
    gap: 3px;
    margin-bottom: 8px;
  }

  .mp-score-num {
    font-family: 'Inter', sans-serif;
    font-size: 1.4rem;
    font-weight: 900;
    line-height: 1;
    letter-spacing: -0.5px;
    font-feature-settings: "tnum";
  }

  .mp-score-pt {
    font-family: 'Inter', sans-serif;
    font-size: 0.65rem;
    font-weight: 700;
    opacity: 0.5;
    letter-spacing: 0.5px;
  }

  .mp-rank-bar-wrap {
    width: 100%;
  }

  .mp-rank-bar-track {
    height: 4px;
    background: rgba(0,0,0,0.2);
    border-radius: 10px;
    overflow: hidden;
  }

  .mp-rank-bar-fill {
    height: 100%;
    background: var(--mp-bar-fill);
    border-radius: 10px;
    transition: width 1s ease;
  }

  .mp-rank-next {
    font-family: 'Inter', sans-serif;
    font-size: 0.58rem;
    font-weight: 700;
    color: var(--mp-text-dim);
    margin-top: 4px;
    letter-spacing: 1px;
    font-feature-settings: "tnum";
  }

  /* ===== EMBLEM AREA ===== */
  .mp-emblem-area {
    margin-top: 32px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
  }

  .mp-emblem {
    width: 72px;
    height: 72px;
    border-radius: 50%;
    background: var(--mp-emblem-bg);
    border: 2px solid var(--mp-emblem-bg);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }

  .mp-emblem i {
    font-size: 1.8rem;
    color: var(--mp-emblem-text);
    opacity: 0.7;
  }

  .mp-emblem-label {
    font-family: 'Inter', sans-serif;
    font-size: 0.75rem;
    font-weight: 800;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--mp-emblem-text);
    opacity: 0.6;
  }

  .mp-emblem-sub {
    font-family: 'Inter', sans-serif;
    font-size: 0.55rem;
    font-weight: 600;
    letter-spacing: 2px;
    color: var(--mp-emblem-text);
    opacity: 0.3;
  }
</style>

<script>
  var mpCache = { today: [], weekly: [] };

  function loadMyPageData(passcode) {
    var pass = passcode || ((typeof window.GLOBAL_PASSCODE !== 'undefined') ? window.GLOBAL_PASSCODE : "");
    google.script.run
      .withSuccessHandler(renderMyPage)
      .withFailureHandler(function (e) { alert("読み込みエラー: " + e.message); })
      .getMyStats(pass);
  }

  function renderMyPage(data) {
    if (!data) return;

    document.getElementById('my-name').innerText = data.name;
    animateValue("my-money", 0, data.estimatedMoney, 900);
    document.getElementById('my-score').innerText = data.currentScore.toLocaleString();

    if (data.nextRankScore > 0) {
      var diff = data.nextRankScore - data.currentScore;
      document.getElementById('score-diff').innerText = diff > 0 ? diff.toLocaleString() : '0';
      var percent = Math.min(100, (data.currentScore / data.nextRankScore) * 100);
      document.getElementById('rank-progress').style.width = percent + "%";
    } else {
      document.getElementById('score-diff').innerText = "MAX";
      document.getElementById('rank-progress').style.width = "100%";
    }

    updateTheme(data.rank);
    mpCache.today = data.todayLog || [];
    mpCache.weekly = data.weeklyLog || [];
  }

  function updateTheme(rank) {
    var app = document.getElementById('app-container');
    app.className = 'mp-wrapper mp-theme-default';

    var rankClass = 'mp-rank-regular';
    var iconClass = 'bi-stars';
    var emblemIcon = 'bi-stars';
    var rankLabel = 'REGULAR';

    if (rank === 'プラチナ')     { rankClass = 'mp-rank-platinum'; iconClass = 'bi-gem';         emblemIcon = 'bi-gem';         rankLabel = 'PLATINUM'; }
    else if (rank === 'ゴールド') { rankClass = 'mp-rank-gold';     iconClass = 'bi-trophy-fill'; emblemIcon = 'bi-trophy-fill'; rankLabel = 'GOLD'; }
    else if (rank === 'シルバー') { rankClass = 'mp-rank-silver';   iconClass = 'bi-award-fill';  emblemIcon = 'bi-award-fill';  rankLabel = 'SILVER'; }
    else if (rank === 'ブロンズ') { rankClass = 'mp-rank-bronze';   iconClass = 'bi-shield-fill'; emblemIcon = 'bi-shield-fill'; rankLabel = 'BRONZE'; }

    app.classList.add(rankClass);
    document.getElementById('my-rank-text').innerText = rank || 'REGULAR';
    document.getElementById('rank-icon').className = 'bi ' + iconClass;
    document.getElementById('mp-emblem-icon').className = 'bi ' + emblemIcon;
    document.getElementById('mp-emblem-rank').innerText = rankLabel;
  }

  function animateValue(id, start, end, duration) {
    var obj = document.getElementById(id);
    if (!obj || end === 0) { if (obj) obj.innerHTML = '0'; return; }
    var range = end - start;
    var current = start;
    var increment = Math.ceil(end / 25) || 1;
    var stepTime = Math.max(10, Math.abs(Math.floor(duration / (range / increment))));
    var timer = setInterval(function () {
      current += increment;
      if (current >= end) { current = end; clearInterval(timer); }
      obj.innerHTML = current.toLocaleString();
    }, stepTime);
  }

  loadMyPageData(window.GLOBAL_PASSCODE);
</script>
